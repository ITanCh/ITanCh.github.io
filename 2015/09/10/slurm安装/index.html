<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>slurm安装 | Tianchi&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="说明
Slurm is an open-source workload manager designed for Linux clusters of all sizes. It provides three key functions. First it allocates exclusive and/or non-exclusive access to resources (computer n">
<meta property="og:type" content="article">
<meta property="og:title" content="slurm安装">
<meta property="og:url" content="http://itanch.github.io/2015/09/10/slurm安装/index.html">
<meta property="og:site_name" content="Tianchi's Blog">
<meta property="og:description" content="说明
Slurm is an open-source workload manager designed for Linux clusters of all sizes. It provides three key functions. First it allocates exclusive and/or non-exclusive access to resources (computer n">
<meta property="og:updated_time" content="2017-02-23T07:42:15.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="slurm安装">
<meta name="twitter:description" content="说明
Slurm is an open-source workload manager designed for Linux clusters of all sizes. It provides three key functions. First it allocates exclusive and/or non-exclusive access to resources (computer n">
  
    <link rel="alternative" href="/atom.xml" title="Tianchi&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" type="image/x-icon" href="/img/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css">

  
<script type="text/javascript">
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?317f9c93ad2152fbda4701e8107d95fe";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>


</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="/img/ahh.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Tian chi</a></h1>
		</hgroup>

		
		<p class="header-subtitle">阅读 思考 实践</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>

				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						<li>友情链接</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
							<li><a href="/tags/技术/">技术</a></li>
				        
							<li><a href="/tags/记录/">记录</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/ITanCh" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="http://weibo.com/liutianchi" title="weibo">weibo</a>
					        
								<a class="mail" target="_blank" href="http://moon.nju.edu.cn/people/tianchiliu/" title="mail">mail</a>
					        
								<a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
					        
						</div>
					</nav>
				</section>

				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/Android/" style="font-size: 17.5px;">Android</a> <a href="/tags/AngularJS/" style="font-size: 10px;">AngularJS</a> <a href="/tags/Cocos2d-x/" style="font-size: 10px;">Cocos2d-x</a> <a href="/tags/JavaScript/" style="font-size: 10px;">JavaScript</a> <a href="/tags/MESOS/" style="font-size: 10px;">MESOS</a> <a href="/tags/MooseFS/" style="font-size: 10px;">MooseFS</a> <a href="/tags/Torque/" style="font-size: 10px;">Torque</a> <a href="/tags/Yeoman/" style="font-size: 10px;">Yeoman</a> <a href="/tags/slurm/" style="font-size: 10px;">slurm</a> <a href="/tags/ubuntu/" style="font-size: 15px;">ubuntu</a> <a href="/tags/技术/" style="font-size: 20px;">技术</a> <a href="/tags/电影/" style="font-size: 10px;">电影</a> <a href="/tags/记录/" style="font-size: 12.5px;">记录</a> <a href="/tags/设计模式/" style="font-size: 10px;">设计模式</a> <a href="/tags/豆瓣/" style="font-size: 10px;">豆瓣</a>
					</div>
				</section>
				

				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://mclspace.com/">Mcl&#39;s space</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://cshuo.xyz/">cshuo的猪窝</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://weibo.com/u/3180792397">夏夏的美丽传说</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://mengzs.com/">Meng ZS&#39;s blog</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://monkey-h.github.io/">monkey-H&#39;s blog</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://co2y.github.io">WeiYi&#39;s blog</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://answ.me/">安大哥的博客</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
				<div id="js-aboutme">1992年生，处女座。2015年本科毕业于南京大学计算机科学与技术系，现于本校软件所继续攻读硕士学位。
				</section>
				</section>
				
			</div>

		</div>

	</header>
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">Tian chi</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="/img/ahh.jpg" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">Tian chi</h1>
			</hgroup>
			
			<p class="header-subtitle">阅读 思考 实践</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
					<li><a href="/tags/技术/">技术</a></li>
		        
					<li><a href="/tags/记录/">记录</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/ITanCh" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/liutianchi" title="weibo">weibo</a>
			        
						<a class="mail" target="_blank" href="http://moon.nju.edu.cn/people/tianchiliu/" title="mail">mail</a>
			        
						<a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap"><article id="post-slurm安装" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/09/10/slurm安装/" class="article-date">
  	<time datetime="2015-09-10T09:17:44.000Z" itemprop="datePublished">2015-09-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      slurm安装
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/slurm/">slurm</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ubuntu/">ubuntu</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/技术/">技术</a></li></ul>
	</div>

        

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><blockquote>
<p>Slurm is an open-source workload manager designed for Linux clusters of all sizes. It provides three key functions. First it allocates exclusive and/or non-exclusive access to resources (computer nodes) to users for some duration of time so they can perform work. Second, it provides a framework for starting, executing, and monitoring work (typically a parallel job) on a set of allocated nodes. Finally, it arbitrates contention for resources by managing a queue of pending work.  </p>
</blockquote>
<p>系统：ubuntu 14.04。slurm版本2.6.5。<br>节点：2个独立的ubuntu14.04计算机。<br><a id="more"></a></p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>在ubuntu中，最简单的安装方法是使用apt-get，目前自动安装的slurm版本为2.6.5，并不是最新版本。<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo apt-get install slurm-llnl</div></pre></td></tr></table></figure>  </p>
<p>安装slurm的同时，会自动创建一个蛋疼的slurm用户，但是这个用户没有home文件，所以无法切换到该用户下进行工作。我的建议是删除旧的slurm用户，同时也是为了munge的正确运行做准备。<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo deluser slurm</div></pre></td></tr></table></figure><br>使用slurm，所有的节点必须在相同的用户下工作，建议新建一个slurm用户，必须指定UID，保证所有节点slurm用户的UID也相同：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo adduser --uid &lt;ID&gt; &lt;new name&gt;</div></pre></td></tr></table></figure></p>
<h3 id="Munge"><a href="#Munge" class="headerlink" title="Munge"></a>Munge</h3><p>在安装slurm的同时，也会安装<a href="https://github.com/dun/munge/wiki/Installation-Guide" target="_blank" rel="external">munge</a>。  </p>
<blockquote>
<p>MUNGE (MUNGE Uid ‘N’ Gid Emporium) is an authentication service for creating and validating credentials. It is designed to be highly scalable for use in an HPC cluster environment. It allows a process to authenticate the UID and GID of another local or remote process within a group of hosts having common users and groups. These hosts form a security realm that is defined by a shared cryptographic key. Clients within this security realm can create and validate credentials without the use of root privileges, reserved ports, or platform-specific methods.  </p>
</blockquote>
<p>1.生成key<br>首先生成key，自动生成至<code>/ete/munge/munge.key</code>：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ create-munge-key</div></pre></td></tr></table></figure></p>
<p>2.部署<br>将key拷贝至所有节点。拷贝<code>/etc/munge/munge.key</code>到所有节点的<code>/etc/munge/</code>目录下。</p>
<p>3.启动<br>启动munge。<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo /etc/init.d/munge start</div></pre></td></tr></table></figure>  </p>
<p>出现错误：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">* Starting MUNGE munged                                                 [fail]</div><div class="line">munged: Error: Logfile is insecure: group-writable permissions <span class="built_in">set</span> on <span class="string">"/var/log"</span></div></pre></td></tr></table></figure><br>出现上述错误需要修改log文件权限：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo chmod g-w /var/<span class="built_in">log</span></div></pre></td></tr></table></figure>  </p>
<p>出现错误：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">* Starting MUNGE munged                                           [fail]</div><div class="line">munged: Error: Logfile is insecure: invalid ownership of <span class="string">"/var/log/munge"</span>  </div></pre></td></tr></table></figure><br>首先尝试使用sudo启动，若不成功，则参考如下。munge安装的所有文件，默认用户为munge:munge，当前用户如果不是munge，启动出现错误：<br>需要修改如下文件的用户：<br>/etc/munge/<br>/var/lib/munge/<br>/var/log/munge/<br>/var/run/munge/<br>修改文件用户的命令：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo chown -R &lt;user&gt;:&lt;group&gt; &lt;dir&gt;  </div></pre></td></tr></table></figure><br>修改/ete/init.d/munge，将USER变量修改为你的用户名。</p>
<p>4.验证<br>在slurm用户下验证本机：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">$ munge -n | unmunge</div><div class="line">STATUS:           Success (0)</div><div class="line">ENCODE_HOST:      localhost (127.0.0.1)</div><div class="line">ENCODE_TIME:      2015-09-14 16:39:58 +0800 (1442219998)</div><div class="line">DECODE_TIME:      2015-09-14 16:39:58 +0800 (1442219998)</div><div class="line">TTL:              300</div><div class="line">CIPHER:           aes128 (4)</div><div class="line">MAC:              sha1 (3)</div><div class="line">ZIP:              none (0)</div><div class="line">UID:              slurm (1023)</div><div class="line">GID:              slurm (1023)</div><div class="line">LENGTH:           0</div></pre></td></tr></table></figure>  </p>
<p>验证其它节点：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">$ munge -n | ssh node01 unmunge</div><div class="line">STATUS:           Success (0)</div><div class="line">ENCODE_HOST:      localhost (127.0.0.1)</div><div class="line">ENCODE_TIME:      2015-09-14 16:40:09 +0800 (1442220009)</div><div class="line">DECODE_TIME:      2015-09-14 16:39:49 +0800 (1442219989)</div><div class="line">TTL:              300</div><div class="line">CIPHER:           aes128 (4)</div><div class="line">MAC:              sha1 (3)</div><div class="line">ZIP:              none (0)</div><div class="line">UID:              slurm (1023)</div><div class="line">GID:              slurm (1023)</div><div class="line">LENGTH:           0</div></pre></td></tr></table></figure>  </p>
<p>注意！munge自动认证的是相同的用户，即UID和GID相同，并不是按照用户名称来匹配，所以在创建slurm用户时必须指定相同的UID和GID。  </p>
<h3 id="slurm配置文件"><a href="#slurm配置文件" class="headerlink" title="slurm配置文件"></a>slurm配置文件</h3><p>在安装文件中有配置工具：<br><code>slurm-xxx/doc/html/configurator.html.in</code><br>如果使用apt-get安装，则需要根据自己slurm的版本信息下载相应的tar文件，解压后使用，<a href="http://www.schedmd.com/#archives" target="_blank" rel="external">slurm所有版本</a>。  </p>
<p>配置文件样例：<br><figure class="highlight vala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div></pre></td><td class="code"><pre><div class="line"><span class="meta"># slurm.conf file generated by configurator.html.</span></div><div class="line"><span class="meta"># Put this file on all nodes of your cluster.</span></div><div class="line"><span class="meta"># See the slurm.conf man page for more information.</span></div><div class="line"><span class="meta">#</span></div><div class="line">ControlMachine=node00</div><div class="line"><span class="meta">#ControlAddr=</span></div><div class="line"><span class="meta">#BackupController=</span></div><div class="line"><span class="meta">#BackupAddr=</span></div><div class="line"><span class="meta">#</span></div><div class="line">AuthType=auth/munge</div><div class="line">CacheGroups=<span class="number">0</span></div><div class="line"><span class="meta">#CheckpointType=checkpoint/none</span></div><div class="line">CryptoType=crypto/munge</div><div class="line"><span class="meta">#DisableRootJobs=NO</span></div><div class="line"><span class="meta">#EnforcePartLimits=NO</span></div><div class="line"><span class="meta">#Epilog=</span></div><div class="line"><span class="meta">#EpilogSlurmctld=</span></div><div class="line"><span class="meta">#FirstJobId=1</span></div><div class="line"><span class="meta">#MaxJobId=999999</span></div><div class="line"><span class="meta">#GresTypes=</span></div><div class="line"><span class="meta">#GroupUpdateForce=0</span></div><div class="line"><span class="meta">#GroupUpdateTime=600</span></div><div class="line"><span class="meta">#JobCheckpointDir=/var/slurm/checkpoint</span></div><div class="line"><span class="meta">#JobCredentialPrivateKey=</span></div><div class="line"><span class="meta">#JobCredentialPublicCertificate=</span></div><div class="line"><span class="meta">#JobFileAppend=0</span></div><div class="line"><span class="meta">#JobRequeue=1</span></div><div class="line"><span class="meta">#JobSubmitPlugins=1</span></div><div class="line"><span class="meta">#KillOnBadExit=0</span></div><div class="line"><span class="meta">#LaunchType=launch/slurm</span></div><div class="line"><span class="meta">#Licenses=foo*4,bar</span></div><div class="line"><span class="meta">#MailProg=/bin/mail</span></div><div class="line"><span class="meta">#MaxJobCount=5000</span></div><div class="line"><span class="meta">#MaxStepCount=40000</span></div><div class="line"><span class="meta">#MaxTasksPerNode=128</span></div><div class="line">MpiDefault=none</div><div class="line"><span class="meta">#MpiParams=ports=#-#</span></div><div class="line"><span class="meta">#PluginDir=</span></div><div class="line"><span class="meta">#PlugStackConfig=</span></div><div class="line"><span class="meta">#PrivateData=jobs</span></div><div class="line">ProctrackType=proctrack/pgid</div><div class="line"><span class="meta">#Prolog=</span></div><div class="line"><span class="meta">#PrologSlurmctld=</span></div><div class="line"><span class="meta">#PropagatePrioProcess=0</span></div><div class="line"><span class="meta">#PropagateResourceLimits=</span></div><div class="line"><span class="meta">#PropagateResourceLimitsExcept=</span></div><div class="line"><span class="meta">#RebootProgram=</span></div><div class="line">ReturnToService=<span class="number">1</span></div><div class="line"><span class="meta">#SallocDefaultCommand=</span></div><div class="line">SlurmctldPidFile=/<span class="keyword">var</span>/run/slurmctld.pid</div><div class="line">SlurmctldPort=<span class="number">6817</span></div><div class="line">SlurmdPidFile=/<span class="keyword">var</span>/run/slurmd.pid</div><div class="line">SlurmdPort=<span class="number">6818</span></div><div class="line">SlurmdSpoolDir=/home/slurm/Slurm</div><div class="line">SlurmUser=slurm</div><div class="line"><span class="meta">#SlurmdUser=root</span></div><div class="line"><span class="meta">#SrunEpilog=</span></div><div class="line"><span class="meta">#SrunProlog=</span></div><div class="line">StateSaveLocation=/home/slurm/Slurm/out</div><div class="line">SwitchType=<span class="keyword">switch</span>/none</div><div class="line"><span class="meta">#TaskEpilog=</span></div><div class="line">TaskPlugin=task/none</div><div class="line"><span class="meta">#TaskPluginParam=</span></div><div class="line"><span class="meta">#TaskProlog=</span></div><div class="line"><span class="meta">#TopologyPlugin=topology/tree</span></div><div class="line"><span class="meta">#TmpFS=/tmp</span></div><div class="line"><span class="meta">#TrackWCKey=no</span></div><div class="line"><span class="meta">#TreeWidth=</span></div><div class="line"><span class="meta">#UnkillableStepProgram=</span></div><div class="line"><span class="meta">#UsePAM=0</span></div><div class="line"><span class="meta">#</span></div><div class="line"><span class="meta">#</span></div><div class="line"><span class="meta"># TIMERS</span></div><div class="line"><span class="meta">#BatchStartTimeout=10</span></div><div class="line"><span class="meta">#CompleteWait=0</span></div><div class="line"><span class="meta">#EpilogMsgTime=2000</span></div><div class="line"><span class="meta">#GetEnvTimeout=2</span></div><div class="line"><span class="meta">#HealthCheckInterval=0</span></div><div class="line"><span class="meta">#HealthCheckProgram=</span></div><div class="line">InactiveLimit=<span class="number">30</span></div><div class="line">KillWait=<span class="number">30</span></div><div class="line"><span class="meta">#MessageTimeout=10</span></div><div class="line"><span class="meta">#ResvOverRun=0</span></div><div class="line">MinJobAge=<span class="number">300</span></div><div class="line"><span class="meta">#OverTimeLimit=0</span></div><div class="line">SlurmctldTimeout=<span class="number">120</span></div><div class="line">SlurmdTimeout=<span class="number">300</span></div><div class="line"><span class="meta">#UnkillableStepTimeout=60</span></div><div class="line"><span class="meta">#VSizeFactor=0</span></div><div class="line">Waittime=<span class="number">300</span></div><div class="line"><span class="meta">#</span></div><div class="line"><span class="meta">#</span></div><div class="line"><span class="meta"># SCHEDULING</span></div><div class="line"><span class="meta">#DefMemPerCPU=0</span></div><div class="line">FastSchedule=<span class="number">1</span></div><div class="line"><span class="meta">#MaxMemPerCPU=0</span></div><div class="line"><span class="meta">#SchedulerRootFilter=1</span></div><div class="line"><span class="meta">#SchedulerTimeSlice=30</span></div><div class="line">SchedulerType=sched/backfill</div><div class="line">SchedulerPort=<span class="number">7321</span></div><div class="line">SelectType=select/linear</div><div class="line"><span class="meta">#SelectTypeParameters=</span></div><div class="line"><span class="meta">#</span></div><div class="line"><span class="meta">#</span></div><div class="line"><span class="meta"># JOB PRIORITY</span></div><div class="line"><span class="meta">#PriorityFlags=</span></div><div class="line"><span class="meta">#PriorityType=priority/basic</span></div><div class="line"><span class="meta">#PriorityDecayHalfLife=</span></div><div class="line"><span class="meta">#PriorityCalcPeriod=</span></div><div class="line"><span class="meta">#PriorityFavorSmall=</span></div><div class="line"><span class="meta">#PriorityMaxAge=</span></div><div class="line"><span class="meta">#PriorityUsageResetPeriod=</span></div><div class="line"><span class="meta">#PriorityWeightAge=</span></div><div class="line"><span class="meta">#PriorityWeightFairshare=</span></div><div class="line"><span class="meta">#PriorityWeightJobSize=</span></div><div class="line"><span class="meta">#PriorityWeightPartition=</span></div><div class="line"><span class="meta">#PriorityWeightQOS=</span></div><div class="line"><span class="meta">#</span></div><div class="line"><span class="meta">#</span></div><div class="line"><span class="meta"># LOGGING AND ACCOUNTING</span></div><div class="line"><span class="meta">#AccountingStorageEnforce=0</span></div><div class="line"><span class="meta">#AccountingStorageHost=</span></div><div class="line"><span class="meta">#AccountingStorageLoc=</span></div><div class="line"><span class="meta">#AccountingStoragePass=</span></div><div class="line"><span class="meta">#AccountingStoragePort=</span></div><div class="line">AccountingStorageType=accounting_storage/none</div><div class="line"><span class="meta">#AccountingStorageUser=</span></div><div class="line">AccountingStoreJobComment=YES</div><div class="line">ClusterName=cluster</div><div class="line"><span class="meta">#DebugFlags=</span></div><div class="line"><span class="meta">#JobCompHost=</span></div><div class="line"><span class="meta">#JobCompLoc=</span></div><div class="line"><span class="meta">#JobCompPass=</span></div><div class="line"><span class="meta">#JobCompPort=</span></div><div class="line">JobCompType=jobcomp/none</div><div class="line"><span class="meta">#JobCompUser=</span></div><div class="line">JobAcctGatherFrequency=<span class="number">30</span></div><div class="line">JobAcctGatherType=jobacct_gather/none</div><div class="line">SlurmctldDebug=<span class="number">3</span></div><div class="line"><span class="meta">#SlurmctldLogFile=</span></div><div class="line">SlurmdDebug=<span class="number">3</span></div><div class="line"><span class="meta">#SlurmdLogFile=</span></div><div class="line"><span class="meta">#SlurmSchedLogFile=</span></div><div class="line"><span class="meta">#SlurmSchedLogLevel=</span></div><div class="line"><span class="meta">#</span></div><div class="line"><span class="meta">#</span></div><div class="line"><span class="meta"># POWER SAVE SUPPORT FOR IDLE NODES (optional)</span></div><div class="line"><span class="meta">#SuspendProgram=</span></div><div class="line"><span class="meta">#ResumeProgram=</span></div><div class="line"><span class="meta">#SuspendTimeout=</span></div><div class="line"><span class="meta">#ResumeTimeout=</span></div><div class="line"><span class="meta">#ResumeRate=</span></div><div class="line"><span class="meta">#SuspendExcNodes=</span></div><div class="line"><span class="meta">#SuspendExcParts=</span></div><div class="line"><span class="meta">#SuspendRate=</span></div><div class="line"><span class="meta">#SuspendTime=</span></div><div class="line"><span class="meta">#</span></div><div class="line"><span class="meta">#</span></div><div class="line"><span class="meta"># COMPUTE NODES</span></div><div class="line">NodeName=node01 CPUs=<span class="number">1</span> State=UNKNOWN</div><div class="line">NodeName=node00 CPUs=<span class="number">1</span> State=UNKNOWN</div><div class="line">PartitionName=debug Nodes=node00,node01 Default=YES MaxTime=INFINITE State=UP</div></pre></td></tr></table></figure>  </p>
<p>将该配置文件拷贝至所有节点，放置于/etc/slurm-llnl/slurm.conf中。</p>
<h3 id="启动和测试slurm"><a href="#启动和测试slurm" class="headerlink" title="启动和测试slurm"></a>启动和测试slurm</h3><p>到所有节点中启动：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo /ete/init.d/slurm-llnl start</div></pre></td></tr></table></figure>  </p>
<p>查看节点信息：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sinfo</div></pre></td></tr></table></figure></p>
<p>测试脚本test：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment">#SBATCH -A &lt;account&gt;</span></div><div class="line"><span class="comment">#SBATCH -D /home/slurm/Slurm</span></div><div class="line"><span class="comment">#SBATCH -I</span></div><div class="line"><span class="comment">#SBATCH --time=00:30:00</span></div><div class="line"><span class="comment">#SBATCH --error=job.%J.err</span></div><div class="line"><span class="comment">#SBATCH --output=job.%J.out</span></div><div class="line"></div><div class="line"><span class="built_in">echo</span> <span class="string">"hello world!"</span></div><div class="line">./hello.sh</div></pre></td></tr></table></figure></p>
<p>运行测试脚本:<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sbatch <span class="built_in">test</span></div></pre></td></tr></table></figure></p>
<p>当某一个job因为某些I/O原因阻塞以后，会导致某个节点一直处于comp状态，重启该节点可以使用如下命令：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ scontrol update NodeName=OptiPlex State=DOWN Reason=hung_completing</div><div class="line">$ scontrol update NodeName=OptiPlex State=RESUME</div></pre></td></tr></table></figure></p>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2015/09/22/MooseFS安装/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"><</strong>
      <div class="article-nav-title">
        
          MooseFS安装
        
      </div>
    </a>
  
  
    <a href="/2015/08/29/豆瓣电影Top250获取/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">豆瓣电影Top250获取</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>


<div class="share">
<!-- JiaThis Button BEGIN -->
<div class="jiathis_style">
	<a class="jiathis_button_qzone"></a>
	<a class="jiathis_button_tsina"></a>
	<a class="jiathis_button_tqq"></a>
	<a class="jiathis_button_weixin"></a>
	<a class="jiathis_button_renren"></a>
	<a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	<a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script>
<!-- JiaThis Button END -->
</div>




<div class="duoshuo">
	<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="slurm安装" data-title="slurm安装" data-url="http://itanch.github.io/2015/09/10/slurm安装/"></div>
	<!-- 多说评论框 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"tianchi"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0]
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
	<!-- 多说公共JS代码 end -->
</div>




</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2017 Tian chi
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/ITanCh/Yilia-c" target="_blank">Yilia-c</a> by Tianchi
      	</div>
    </div>
  </div>
</footer>

    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>