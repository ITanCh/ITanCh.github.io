<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Android系统源码阅读(3):子Activity在进程内的启动过程 · Tianchi's Blog</title><meta name="description" content="Android系统源码阅读(3):子Activity在进程内的启动过程 - Tian chi"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/long.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://itanch.github.io/atom.xml" title="Tianchi's Blog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/long.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/ITanCh" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Android系统源码阅读(3):子Activity在进程内的启动过程</h1><div class="post-info">Feb 14, 2017</div><div class="post-content"><blockquote>
<p>该系列只记录阅读代码时遇到的问题和心得体会，具体代码讲解可以参考老罗的《Android系统源代码情景分析》，我就不班门弄斧了。我编译的AOSP版本：6.0.1_r50。</p>
</blockquote>
<h2 id="子Activity在进程内的启动过程"><a href="#子Activity在进程内的启动过程" class="headerlink" title="子Activity在进程内的启动过程"></a>子Activity在进程内的启动过程</h2><h3 id="Step1-Activity开始启动另一个Activity"><a href="#Step1-Activity开始启动另一个Activity" class="headerlink" title="Step1. Activity开始启动另一个Activity"></a>Step1. Activity开始启动另一个Activity</h3><p><img src="http://img.blog.csdn.net/20160817155832276" alt="这里写图片描述"><br>这里和从Launcher启动过程几乎没分别，但是启动有些参数的设置还是有区别的。</p>
<a id="more"></a>
<h3 id="Step2-ActivityManagerService准备"><a href="#Step2-ActivityManagerService准备" class="headerlink" title="Step2. ActivityManagerService准备"></a>Step2. ActivityManagerService准备</h3><p><img src="http://img.blog.csdn.net/20160817160041764" alt="这里写图片描述"><br>同样这些会先停止正在最前端的Activity。</p>
<h3 id="Step3-旧Activity停止"><a href="#Step3-旧Activity停止" class="headerlink" title="Step3. 旧Activity停止"></a>Step3. 旧Activity停止</h3><p><img src="http://img.blog.csdn.net/20160817160321578" alt="这里写图片描述"><br>同样这里需要在完成停止过程后告知ActivityManagerService。</p>
<h3 id="Step4-ActivityManagerService继续准备"><a href="#Step4-ActivityManagerService继续准备" class="headerlink" title="Step4.  ActivityManagerService继续准备"></a>Step4.  ActivityManagerService继续准备</h3><p><img src="http://img.blog.csdn.net/20160817160534704" alt="这里写图片描述"><br>万事俱备，只待真的启动Activity。</p>
<h3 id="Step5-新Activity创建"><a href="#Step5-新Activity创建" class="headerlink" title="Step5. 新Activity创建"></a>Step5. 新Activity创建</h3><p><img src="http://img.blog.csdn.net/20160817160656204" alt="这里写图片描述"><br>到这里启动完毕。</p>
<h2 id="Task-Process-and-Activity"><a href="#Task-Process-and-Activity" class="headerlink" title="Task, Process and Activity"></a>Task, Process and Activity</h2><p>这几个概念真的很让人混淆，最基本的一句话是它们几个是完全不同的抽象概念。</p>
<p>先说Process和Activity。一个Application可以多个Activity和多个Process。两个Activity可以运行在相同的Process里，也可以在不同的Process里，这里可以在AndroidManifest.xml中设置<code>android:process</code>，默认情况下是运行在同一个Process里的。并且该进程中的Activity、Service都是运行在主线程中，所以Service也不是一个独立的线程概念，不可以直接在Service中运行耗时的任务。</p>
<p>Task同样和Process没有一一对应的关系。Task是描述Activity跳转状态的栈，利用后退操作是在同一个栈中进行Activity的回退；同样，某一个Activity启动了其它Application的Activity（比如你的app调用了系统自带的相册app），这两个Activity同样会放置于同一个栈中，虽然这两个acitivity明显不在同一个Application中，也有可能不在同一个Process中。Task在用户通过任务管理器来切换时，则会发生交换。将前台的Task放到后面，你选择的Task则会置于最前端。</p>
</div></article></div></main><footer><div class="paginator"><a href="/2017/02/14/Android系统源码阅读-4-Service在新进程中启动过程/" class="prev">上一篇</a><a href="/2017/02/14/Android系统源码阅读-2-根Activity组件的启动过程/" class="next">下一篇</a></div><div data-thread-key="2017/02/14/Android系统源码阅读-3-子Activity在进程内的启动过程/" data-title="Android系统源码阅读(3):子Activity在进程内的启动过程" data-url="http://itanch.github.io/2017/02/14/Android系统源码阅读-3-子Activity在进程内的启动过程/" data-author-key="1" class="ds-thread"></div><script>var duoshuoQuery = {short_name:"tianchi"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
})();

</script><div class="copyright"><p>© 2016 - 2017 <a href="http://itanch.github.io">Tian chi</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>