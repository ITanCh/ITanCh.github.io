<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Ubuntu PPTPD 配置 · Tianchi's Blog</title><meta name="description" content="Ubuntu PPTPD 配置 - Tian chi"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/long.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://itanch.github.io/atom.xml" title="Tianchi's Blog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/long.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/ITanCh" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Ubuntu PPTPD 配置</h1><div class="post-info">Feb 14, 2017</div><div class="post-content"><h2 id="Server配置"><a href="#Server配置" class="headerlink" title="Server配置"></a>Server配置</h2><h3 id="安装pptpd"><a href="#安装pptpd" class="headerlink" title="安装pptpd"></a>安装pptpd</h3><p>首先需要安装pptpd，ubuntu 默认安装该工具。 </p>
<a id="more"></a>
<h3 id="配置网络"><a href="#配置网络" class="headerlink" title="配置网络"></a>配置网络</h3><p>编辑 <code>/etc/pptpd.conf</code>，取消以下两行注释。当然也可以自己设定ip地址范围，这里使用默认的就可以。<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">localip <span class="number">192.168</span><span class="number">.0</span><span class="number">.1</span></div><div class="line">remoteip <span class="number">192.168</span><span class="number">.0</span><span class="number">.234</span><span class="number">-238</span>,<span class="number">192.168</span><span class="number">.0</span><span class="number">.245</span></div></pre></td></tr></table></figure></p>
<h3 id="添加用户"><a href="#添加用户" class="headerlink" title="添加用户"></a>添加用户</h3><p>编辑<code>/etc/ppp/chap-secrets</code>文件，用户名添加如下：<br><figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"> # Secrets for authentication using CHAP</div><div class="line"> # client    server  secret          IP addresses</div><div class="line">   [client name]  *   <span class="string">"[password]"</span> *</div><div class="line">```  </div><div class="line">其中client的名字和密码自己设定即可，其它两项默认<span class="string">"*"</span>就可以。</div><div class="line"></div><div class="line">### 设置DNS</div><div class="line">编辑`/etc/ppp/pptpd-options`，找到`ms-dns`部分，取消注释：</div></pre></td></tr></table></figure></p>
<p> ms-dns 223.5.5.5<br> ms-dns 223.6.6.6<br><figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">默认的是google的DNS服务，`<span class="number">8.8</span><span class="number">.8</span><span class="number">.8</span>`。因为国内使用不便，这里我修改成阿里的DNS服务。</div><div class="line"></div><div class="line">### 开启IP转发</div><div class="line">编辑`/etc/sysctl.conf`文件，取消注释：</div></pre></td></tr></table></figure></p>
<p>net.ipv4.ip_forward=1<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">运行命令，使配置生效：</div></pre></td></tr></table></figure></p>
<p>sysctl -p<br><figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">### iptables安装</div><div class="line">安装iptables:</div></pre></td></tr></table></figure></p>
<p>apt-get install iptables<br>iptables -t nat -I POSTROUTING -j MASQUERADE #每次运行前需要运行该命令<br><figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">### 重启pptpd</div></pre></td></tr></table></figure></p>
<p>/etc/init.d/pptpd restart<br><figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">##Client配置</div><div class="line">在你需要使用代理的ubuntu设备上执行以下操作。当然，也可以用其它客户端。</div><div class="line"></div><div class="line">### 安装pptp</div><div class="line">一般系统已经默认安装。</div></pre></td></tr></table></figure></p>
<p>sudo apt-get install pptp-linux<br><figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">### 创建一个连接</div></pre></td></tr></table></figure></p>
<p>sudo pptpsetup –create [server name] –server [server ip] –username [client name] –password [password] –encrypt –start<br><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">执行完上述命令后，会在`/etc/ppp/chap-secrets`自动生成相应的用户：</div></pre></td></tr></table></figure></p>
<h1 id="added-by-pptpsetup-for-pptpd"><a href="#added-by-pptpsetup-for-pptpd" class="headerlink" title="added by pptpsetup for pptpd"></a>added by pptpsetup for pptpd</h1><p>[client name] [server name] “password” *<br><figure class="highlight autoit"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">在`/etc/ppp/peers/pptpd`中也会有生成的相应信息，这里需要注意一点，默认的是不用server 的DNS配置的，所以会出现<span class="built_in">ping</span> ip地址可以成功，<span class="built_in">ping</span>网址却失败的DNS解析错误，所以要加上如下一行:</div></pre></td></tr></table></figure></p>
<p>usepeerdns<br><figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">在上述命令成功后，`ifconfig`命令下回出现ppp0端口。</div><div class="line"></div><div class="line">### 路由设置</div><div class="line">将ppp0设置为默认路由端口：</div></pre></td></tr></table></figure></p>
<p>ip route del default<br>ip route add default dev ppp0<br><figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">这样配置基本算成功了。</div><div class="line"></div><div class="line">### 服务开关</div><div class="line">我自己写了如下命令方便开关和路由设置：</div><div class="line"></div><div class="line">打开服务(需要sudo):</div></pre></td></tr></table></figure></p>
<p>#!/bin/bash<br>pon [server name]<br>sleep 4<br>ip route del default<br>ip route add default dev ppp0<br><figure class="highlight gcode"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">关闭服务<span class="comment">(sudo)</span>:</div></pre></td></tr></table></figure></p>
<p>#!/bin/bash<br>poff pptpd<br>sleep 4<br>ip route del default<br>ip route add default via [your old route ip] dev eno1<br>```<br>这里需要记住原来设备的路由ip，以便删除后再回复。</p>
</div></article></div></main><footer><div class="paginator"><a href="/2017/02/14/Nexus7搞机教程/" class="prev">PREV</a><a href="/2017/02/14/cocos2d-x安装/" class="next">NEXT</a></div><div data-thread-key="2017/02/14/UbuntuPPTPD配置/" data-title="Ubuntu PPTPD 配置" data-url="http://itanch.github.io/2017/02/14/UbuntuPPTPD配置/" data-author-key="1" class="ds-thread"></div><script>var duoshuoQuery = {short_name:"tianchi"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
})();

</script><div class="copyright"><p>© 2016 - 2017 <a href="http://itanch.github.io">Tian chi</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>